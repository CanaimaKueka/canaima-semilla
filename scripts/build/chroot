#!/bin/sh

# lh_chroot(1) - customize the Debian system
# Copyright (C) 2006-2010 Daniel Baumann <daniel@debian.org>
#
# live-helper comes with ABSOLUTELY NO WARRANTY; for details see COPYING.
# This is free software, and you are welcome to redistribute it
# under certain conditions; see COPYING for details.

set -e

# Including common functions
. "${LH_BASE:-/usr/share/canaima-semilla}"/scripts/build.sh

# Setting static variables
DESCRIPTION="$(Echo 'customize the Debian system')"
HELP=""
USAGE="${PROGRAM} [--force]"

Arguments "${@}"

# Reading configuration files
Read_conffiles config/all config/common config/bootstrap config/chroot config/binary config/source
Set_defaults

# Setup cleanup function
Setup_cleanup

Echo_message "--- ETAPA DE CONFIGURACIÓN DEL SISTEMA BASE (CHROOT) ---"
Echo_message "En ésta etapa se customiza el sistema base con las características especificadas en la configuración de canaima-semilla, para ello se montan los dispositivos y se crean los archivos de configuración necesarios."

# Configuring chroot
canaima-semilla chroot_cache restore ${*}
canaima-semilla chroot_devpts install ${*}
canaima-semilla chroot_proc install ${*}
canaima-semilla chroot_selinuxfs install ${*}
canaima-semilla chroot_sysfs install ${*}
canaima-semilla chroot_debianchroot install ${*}
canaima-semilla chroot_dpkg install ${*}
canaima-semilla chroot_sysv-rc install ${*}
canaima-semilla chroot_upstart install ${*}
canaima-semilla chroot_hosts install ${*}
canaima-semilla chroot_resolv install ${*}
canaima-semilla chroot_hostname install ${*}
canaima-semilla chroot_apt install ${*}
canaima-semilla chroot_sources install ${*}
canaima-semilla chroot_linux-image install ${*}

# Customizing chroot
canaima-semilla chroot_preseed ${*}
canaima-semilla chroot_local-preseed ${*}
canaima-semilla chroot_tasks ${*}
canaima-semilla chroot_packageslists ${*}
canaima-semilla chroot_local-packageslists ${*}
canaima-semilla chroot_packages ${*}
canaima-semilla chroot_local-packages ${*}
canaima-semilla chroot_install-packages ${*}
canaima-semilla chroot_localization ${*}
canaima-semilla chroot_local-includes ${*}
canaima-semilla chroot_local-patches ${*}
canaima-semilla chroot_sysvinit ${*}
canaima-semilla chroot_local-hooks ${*}
canaima-semilla chroot_hooks ${*}
canaima-semilla chroot_symlinks ${*}
canaima-semilla chroot_hacks ${*}
canaima-semilla chroot_interactive ${*}

# Deconfiguring chroot
canaima-semilla chroot_linux-image remove ${*}
canaima-semilla chroot_sources remove ${*}
canaima-semilla chroot_apt remove ${*}
canaima-semilla chroot_hostname remove ${*}
canaima-semilla chroot_resolv remove ${*}
canaima-semilla chroot_hosts remove ${*}
canaima-semilla chroot_sysv-rc remove ${*}
canaima-semilla chroot_upstart remove ${*}
canaima-semilla chroot_dpkg remove ${*}
canaima-semilla chroot_debianchroot remove ${*}
canaima-semilla chroot_sysfs remove ${*}
canaima-semilla chroot_selinuxfs remove ${*}
canaima-semilla chroot_proc remove ${*}
canaima-semilla chroot_devpts remove ${*}
canaima-semilla chroot_cache save ${*}
